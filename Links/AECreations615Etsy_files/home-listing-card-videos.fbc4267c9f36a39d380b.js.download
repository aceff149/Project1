(()=>{var e={59189:(e,t,i)=>{e.exports=i(23264)(1089)},62721:(e,t,i)=>{e.exports=i(23264)(1243)},2514:(e,t,i)=>{e.exports=i(23264)(2137)},17994:(e,t,i)=>{e.exports=i(23264)(2238)},94220:(e,t,i)=>{e.exports=i(23264)(3693)},47045:(e,t,i)=>{e.exports=i(23264)(6220)},65059:(e,t,i)=>{e.exports=i(23264)(8321)},23264:e=>{"use strict";e.exports=etsy_libs_b4d1730fdf931215e702}};var t={};function i(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};e[s](n,n.exports,i);return n.exports}(()=>{i.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;i.d(t,{a:t});return t}})();(()=>{i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:true,get:t[s]})}})();(()=>{i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{"use strict";var e=i(65059);var t=i.n(e);var s=i(17994);var o=i(94220);var n=i(59189);var a=i(47045);var d=i(62721);function l(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}const r={maxLoops:5,minBufferedPercentage:0,moduleName:"",enableSentryErrors:true};const h=5;const u="wt_video_base";const v={FINISHED_FIRST_PLAY:`${u}.finished_first_video_play`,LOOP:`${u}.loop`,FINISHED_AUTOPLAY:`${u}.finished_autoplay`,PLAY:`${u}.play`,PLAYING:`${u}.playing`,PAUSE:`${u}.pause`,STOP:`${u}.stop`,CLICK:`${u}.click`,STARTED_LOADING_VIDEO:`${u}.started_loading_video`,LOADED_VIDEO:`${u}.loaded_video`,ERROR:`${u}.error`};const c={DEFAULT_OPTIONS:r,BUFFER_STALLED_LIMIT:h,EVENTS:v};class p{constructor(e,t){l(this,"options",void 0);l(this,"elements",void 0);l(this,"state","unloaded");l(this,"isEligibleToPlay",void 0);l(this,"clicked",void 0);l(this,"videoPlayCount",void 0);l(this,"totalVideoPlayCount",void 0);l(this,"lastBufferedTime",void 0);l(this,"bufferStalledCount",void 0);l(this,"playStartPromise",void 0);this.options={...c.DEFAULT_OPTIONS,...t};this.bindToTargetedHTML(e);this.setState("unloaded");this.playStartPromise=null;this.isEligibleToPlay=true;this.clicked=false;this.videoPlayCount=0;this.totalVideoPlayCount=0;this.lastBufferedTime=0;this.bufferStalledCount=0;this.attachHandlers()}play(){this.isEligibleToPlay=true;this.dispatchCustomEventWithData(c.EVENTS.PLAY);if(null!==this.playStartPromise)return this.playStartPromise;if(this.isPlaying())return Promise.resolve();if(!this.isEligibleToPlay)return Promise.reject("WtVideoBase play(): video is not eligible to play");this.clicked=false;this.playStartPromise=this.loadVideo().then(this.checkVideoBuffer.bind(this)).then(this.playWithoutLoading.bind(this)).finally((()=>{this.playStartPromise=null}));return this.playStartPromise}stop(){this.isEligibleToPlay=false;if(!this.isPlaying())return;this.elements.video.pause();this.setState("ready");this.dispatchCustomEventWithData(c.EVENTS.STOP,{videoPlayCount:this.videoPlayCount,clicked:this.clicked,duration:this.elements.video.currentTime});this.elements.video.currentTime=0;this.videoPlayCount=0}pause(){if(!this.isPlaying())return;this.dispatchCustomEventWithData(c.EVENTS.PAUSE,{videoPlayCount:this.videoPlayCount,clicked:this.clicked,duration:this.elements.video.currentTime});this.elements.video.pause();this.setState("ready")}getCurrentState(){return this.state}isPlaying(){return"playing"===this.state}isLoading(){return"loading"===this.state}isReady(){return"ready"===this.state}setState(e){this.state=e}bindToTargetedHTML(e){if(!(e instanceof HTMLVideoElement))throw new Error("WtVideoBase needs a video element to be passed in");const t=e.querySelectorAll("source");if(t.length<1)throw new Error("WtVideoBase needs at least one source");this.elements={video:e,sources:t}}attachHandlers(){this.elements.video["controls"]&&this.attachListenersForUIControls();this.elements.sources.item(this.elements.sources.length-1).addEventListener("error",(e=>{this.onError(e||new Error("Error loading video source"))}));this.elements.video.addEventListener("ended",(()=>{this.onVideoEnd()}));this.elements.video.addEventListener("click",(()=>{this.clicked=true;this.dispatchCustomEventWithData(c.EVENTS.CLICK,{videoPlayCount:this.videoPlayCount,duration:this.elements.video.currentTime})}))}attachListenersForUIControls(){this.elements.video.addEventListener("loadstart",(()=>{this.setState("loading")}));this.elements.video.addEventListener("play",(()=>{this.elements.video.readyState>this.elements.video.HAVE_CURRENT_DATA?this.setState("playing"):this.setState("loading")}));this.elements.video.addEventListener("playing",(()=>{this.setState("playing")}));this.elements.video.addEventListener("loadeddata",(()=>{this.setState("ready")}));this.elements.video.addEventListener("pause",(()=>{if(this.elements.video.readyState>this.elements.video.HAVE_CURRENT_DATA)this.setState("ready");else{this.setState("unloaded");this.bufferStalledCount=0}}))}loadVideo(){if(this.isLoading()||this.isReady()&&1!==this.elements.video.readyState)return Promise.resolve();return new Promise(((e,t)=>{this.setState("loading");this.elements.video.addEventListener("loadeddata",function t(){this.elements.video.removeEventListener("loaddeddata",t);e(void 0)}.bind(this));this.elements.video.addEventListener("error",(e=>{this.onError(e);t(e)}));this.elements.video.load();this.dispatchCustomEventWithData(c.EVENTS.STARTED_LOADING_VIDEO)}))}checkVideoBuffer(){if(this.isReady())return Promise.resolve();if(!this.isEligibleToPlay)return Promise.reject("WtVideoBase checkVideoBuffer(): video is not eligible to play");if(this.isBufferedEnough()){this.setState("ready");this.dispatchCustomEventWithData(c.EVENTS.LOADED_VIDEO);return Promise.resolve()}return new Promise((e=>{setTimeout((()=>{e(void 0)}),250)})).then((()=>this.checkVideoBuffer()))}playWithoutLoading(){if(this.isPlaying())return Promise.resolve();if(!this.isEligibleToPlay)return Promise.reject("WtVideoBase playWithoutLoading(): video is not eligible to play");return(this.elements.video.play()||Promise.resolve()).then((()=>{this.setState("playing");this.dispatchCustomEventWithData(c.EVENTS.PLAYING)})).catch((e=>{this.onError(e)}))}onVideoEnd(){0===this.totalVideoPlayCount&&this.dispatchCustomEventWithData(c.EVENTS.FINISHED_FIRST_PLAY);this.videoPlayCount++;this.totalVideoPlayCount++;if(this.videoPlayCount<this.options.maxLoops){this.setState("ready");this.playWithoutLoading().then((()=>{this.dispatchCustomEventWithData(c.EVENTS.LOOP,{videoPlayCount:this.videoPlayCount})})).catch((()=>{this.stop()}))}else{this.stop();this.dispatchCustomEventWithData(c.EVENTS.FINISHED_AUTOPLAY)}}isBufferedEnough(){if(0===this.options.minBufferedPercentage)return true;const e=this.elements.video.buffered.length?this.elements.video.buffered.end(0):0;e===this.lastBufferedTime&&e!==this.elements.video.duration?this.bufferStalledCount++:this.lastBufferedTime=e;const t=e/this.elements.video.duration>=this.options.minBufferedPercentage;const i=this.bufferStalledCount>c.BUFFER_STALLED_LIMIT;return t||i}onError(e){this.setState("unloaded");this.bufferStalledCount=0;this.dispatchCustomEventWithData(c.EVENTS.ERROR,e);this.options.enableSentryErrors&&this.logSentryError(e)}logSentryError(e){n["default"].captureException(e||new Error("Error playing video"),{tags:{component:"WtVideoBase",module:this.options.moduleName}})}dispatchCustomEventWithData(e,t={}){this.elements.video.dispatchEvent(new CustomEvent(e,{detail:{module:this.options.moduleName,totalVideoPlayCount:this.totalVideoPlayCount,...t}}))}}function g(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}const m={SPINNER:".wt-video__spinner",SIGNAL:".wt-video__signal",PLAY:"button [data-wt-video-play-signal]",PAUSE:"button [data-wt-video-pause-signal]",VIDEO:".wt-video__element"};const E={maxLoops:5,minBufferedPercentage:0,moduleName:"",enableSentryErrors:true};const S="wt_video_preview";const f={LOADED_VIDEO:`${S}.loaded_video`};const y={DEFAULT_OPTIONS:E,EVENTS:f,SELECTORS:m};class P{constructor(e,t){g(this,"options",void 0);g(this,"elements",void 0);g(this,"isPlayCloseButtonActive",void 0);g(this,"isPlaying",void 0);g(this,"totalVideoPlayCount",void 0);g(this,"totalVideoShownCount",void 0);g(this,"showSpinnerStartedTime",void 0);g(this,"showSpinnerAccumulatedTime",void 0);g(this,"videoBase",void 0);g(this,"disableOnHover",void 0);this.options={...y.DEFAULT_OPTIONS,...t};this.bindToTargetedHTML(e);this.isPlaying=false;this.isPlayCloseButtonActive=false;this.disableOnHover=false;this.totalVideoPlayCount=0;this.totalVideoShownCount=0;this.showSpinnerStartedTime=0;this.showSpinnerAccumulatedTime=0;this.elements.playSignal?this.a11yShowVisualState(this.elements.playSignal):this.a11yShowVisualState(this.elements.signal);this.attachHandlers()}play(){if(this.isPlayCloseButtonActive||this.disableOnHover)return Promise.resolve();this.isPlaying=true;return this.videoBase.play().catch((()=>{this.updateVisualLoadingState();this.updateVisualPlayingState();return"video did not play because it was not eligible to play"}))}stop(){if(this.isPlayCloseButtonActive)return;this.isPlaying=false;this.videoBase.stop();this.updateVisualLoadingState();this.updateVisualPlayingState()}pause(){if(this.isPlayCloseButtonActive)return;this.isPlaying=false;this.videoBase.pause()}bindToTargetedHTML(e){const t=e.querySelector(y.SELECTORS.SPINNER);const i=e.querySelector(y.SELECTORS.SIGNAL);const s=e.querySelector(y.SELECTORS.PLAY);const o=e.querySelector(y.SELECTORS.PAUSE);const n=e.querySelector(y.SELECTORS.VIDEO);if(!(t instanceof HTMLElement))throw new Error("WtVideoPreview needs a spinner with the class .wt-video__spinner");if(!(i instanceof HTMLElement))throw new Error("WtVideoPreview needs a play signal with the class .wt-video__signal");if(!(n instanceof HTMLVideoElement))throw new Error("WtVideoPreview needs a video element as a child of the root element that was passed in");this.videoBase=new p(n,this.options);this.elements={root:e,video:n,spinner:t,signal:i,playSignal:null!==s&&void 0!==s?s:void 0,pauseSignal:null!==o&&void 0!==o?o:void 0}}attachHandlers(){this.elements.video.addEventListener(c.EVENTS.STARTED_LOADING_VIDEO,(()=>{this.updateVisualLoadingState();0===this.showSpinnerStartedTime&&(this.showSpinnerStartedTime=performance.now())}));this.elements.video.addEventListener(c.EVENTS.LOADED_VIDEO,(()=>{var e,t;if(0!==this.showSpinnerStartedTime){this.showSpinnerAccumulatedTime+=performance.now()-this.showSpinnerStartedTime;this.showSpinnerStartedTime=0}this.updateVisualLoadingState();const i=0===this.totalVideoShownCount?{spinnerShownTime:this.showSpinnerAccumulatedTime}:{};this.dispatchCustomEventWithData(y.EVENTS.LOADED_VIDEO,i);this.totalVideoShownCount++;null===(e=(t=this.options).onVideoStateChange)||void 0===e?void 0:e.call(t,c.EVENTS.LOADED_VIDEO)}));this.elements.video.addEventListener(c.EVENTS.PLAYING,(()=>{var e,t;this.updateVisualPlayingState();null===(e=(t=this.options).onVideoStateChange)||void 0===e?void 0:e.call(t,c.EVENTS.PLAYING)}));this.elements.video.addEventListener(c.EVENTS.PAUSE,(()=>{var e,t;null===(e=(t=this.options).onVideoStateChange)||void 0===e?void 0:e.call(t,c.EVENTS.PAUSE)}));this.elements.video.addEventListener(c.EVENTS.STOP,(()=>{var e,t;this.updateVisualLoadingState();this.updateVisualPlayingState();null===(e=(t=this.options).onVideoStateChange)||void 0===e?void 0:e.call(t,c.EVENTS.STOP)}));this.elements.video.addEventListener(c.EVENTS.ERROR,(()=>{var e,t;this.updateVisualLoadingState();this.updateVisualPlayingState();null===(e=(t=this.options).onVideoStateChange)||void 0===e?void 0:e.call(t,c.EVENTS.ERROR)}));this.elements.signal instanceof HTMLButtonElement&&this.elements.signal.addEventListener("click",(e=>{this.isPlaying?this.pause():this.play();this.updateVisualPlayingState();e.stopPropagation()}))}updateVisualPlayingState(){if(this.elements.playSignal&&this.elements.pauseSignal)if(this.isPlaying){this.a11yHideVisualState(this.elements.playSignal);this.a11yShowVisualState(this.elements.pauseSignal);this.a11yShowVisualState(this.elements.video)}else{this.a11yShowVisualState(this.elements.playSignal);this.a11yHideVisualState(this.elements.pauseSignal);this.a11yHideVisualState(this.elements.video)}else if(this.isPlaying){this.a11yHideVisualState(this.elements.signal);this.a11yShowVisualState(this.elements.video)}else{this.a11yShowVisualState(this.elements.signal);this.a11yHideVisualState(this.elements.video)}}updateVisualLoadingState(){this.videoBase.isLoading()&&this.isPlaying?this.a11yShowVisualState(this.elements.spinner):this.a11yHideVisualState(this.elements.spinner)}dispatchCustomEventWithData(e,t={}){this.elements.video.dispatchEvent(new CustomEvent(e,{detail:{module:this.options.moduleName,totalVideoPlayCount:this.totalVideoPlayCount,...t}}))}a11yShowVisualState(e){const t=e;if(t===this.elements.playSignal||t===this.elements.pauseSignal||t===this.elements.signal)t.classList.remove("wt-video__signal--hidden");else if(t===this.elements.video)t.classList.remove("wt-video__element--hidden");else if(t===this.elements.spinner){t.classList.add("wt-video__spinner--visible");t.classList.remove("wt-video__spinner--hidden")}t.setAttribute("aria-hidden","false")}a11yHideVisualState(e){const t=e;if(t===this.elements.playSignal||t===this.elements.pauseSignal||t===this.elements.signal)t.classList.add("wt-video__signal--hidden");else if(t===this.elements.video)t.classList.add("wt-video__element--hidden");else if(t===this.elements.spinner){t.classList.add("wt-video__spinner--hidden");t.classList.remove("wt-video__spinner--visible")}t.setAttribute("aria-hidden","true")}}var L=i(2514);function T(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true}):e[t]=i;return e}class _{constructor(e,t,i){T(this,"options",void 0);T(this,"elements",void 0);T(this,"isTriggerHovered",void 0);T(this,"isTriggerFocused",void 0);T(this,"isActive",void 0);T(this,"videoPreview",void 0);this.options={...y.DEFAULT_OPTIONS,...i};this.bindToTargetedHTML(e,t);this.isTriggerHovered=false;this.isTriggerFocused=false;this.isActive=this.isTriggerHovered||this.isTriggerFocused;L["default"].prefersReducedMotion()||this.attachHandlers()}play(){return this.videoPreview.play()}stop(){this.videoPreview.stop()}bindToTargetedHTML(e,t){this.videoPreview=new P(e,this.options);this.elements={root:e,activeTrigger:t}}attachHandlers(){this.elements.activeTrigger.addEventListener("mouseenter",(()=>{this.isTriggerHovered=true;this.updateActiveState()}));this.elements.activeTrigger.addEventListener("mouseleave",(()=>{var e;if(null!==(e=this.elements.root.querySelector("button"))&&void 0!==e&&e.matches(":hover"))return;this.isTriggerHovered=false;this.updateActiveState()}));this.elements.activeTrigger.addEventListener("focus",(()=>{this.isTriggerFocused=true;this.updateActiveState()}));this.elements.activeTrigger.addEventListener("blur",(()=>{this.isTriggerFocused=false;this.updateActiveState()}))}updateActiveState(){const e=this.isTriggerHovered||this.isTriggerFocused;if(this.isActive!==e){this.isActive=e;this.isActive?this.videoPreview.play():this.videoPreview.stop()}}}const V=5;const w=.2;const C={selector:"listing-card-video",numOfLoops:5,enoughBufferedPercentage:0,moduleName:""};class A{constructor(e,t){this.options=t;this.videoEl=e;this.videoContainer=e.parentElement;this.mediaContainer=this.setUpMediaContainer(this.videoContainer.parentElement);this.spinner=this.videoContainer.previousElementSibling;this.signal=this.videoContainer.nextElementSibling;this.sources=this.videoEl.querySelectorAll("source");this.listingId=e.getAttribute("data-listing-id");this.isActive=false;this.isLoading=false;this.isReady=false;this.isPlaying=false;this.clicked=false;this.videoPlayCount=0;this.totalVideoPlayCount=0;this.totalVideoShownCount=0;this.lastBufferedTime=0;this.bufferStalledCount=0;this.showSpinnerStartedTime=0;this.showSpinnerAccumulatedTime=0;this.videoOptimizations=a["default"].getBoolean("is_eligible_for_video_optimizations",false);this.initialSetup();this.attachHandlers()}setUpMediaContainer(e){this.isEligibleForImageAndVideoCarousel=a["default"].getBoolean("is_eligible_for_image_and_video_carousel",false);if(this.isEligibleForImageAndVideoCarousel){const t=e.closest("div.main-carousel");if(!t)return e;this.oldMediaContainer=e;return e.closest("div.main-carousel")}return e}initialSetup(){this.videoEl.removeAttribute(this.options.selector);d["default"].wtAccessibleShow(this.signal);this.sources[this.sources.length-1].addEventListener("error",(e=>{this.onError(e||new Error("Error loading video source"))}));this.mediaContainer.setAttribute("tabindex","0");this.videoEl.addEventListener("ended",(()=>{this.onVideoEnd()}))}onVideoEnd(){this.isPlaying=false;0===this.totalVideoPlayCount&&this.logEventPipe("finished_first_video_play");this.videoPlayCount++;this.totalVideoPlayCount++;if(this.videoPlayCount<this.options.numOfLoops){this._play();this.statsD("loop");this.logEventPipe("loop",{videoPlayCount:this.videoPlayCount,listingId:this.listingId})}else{this.statsD("finished_autoplay");this.logEventPipe("finished_autoplay");this.videoPlayCount=0}}attachHandlers(){const e=()=>{this.clicked=false;this.isActive=true;this.play();this.statsD("play");this.logEventPipe("play",{listingId:this.listingId})};this.mediaContainer.addEventListener("mouseenter",e);this.mediaContainer.addEventListener("focus",e);const t=e=>{if(e.relatedTarget&&"favorite-listing-button"===e.relatedTarget.getAttribute("data-ui"))return;this.isActive=false;this.updateLoadingState();this.updatePlayingState();const t=this.videoEl.currentTime;this.stop();this.statsD("stop");this.logEventPipe("stop",{videoPlayCount:this.videoPlayCount,clicked:this.clicked,duration:t})};this.mediaContainer.addEventListener("mouseleave",t);this.mediaContainer.addEventListener("blur",t);const i=()=>{this.clicked=true;this.statsD("click");this.logEventPipe("click",{videoPlayCount:this.videoPlayCount,duration:this.videoEl.currentTime})};this.isEligibleForImageAndVideoCarousel?this.oldMediaContainer.addEventListener("click",i):this.mediaContainer.addEventListener("click",i);this.mediaContainer.addEventListener("keydown",(e=>{if(!!e.code&&("Enter"===e.code||"Space"===e.code)){var t;i();null===(t=e.target.closest("a"))||void 0===t?void 0:t.dispatchEvent(new MouseEvent("click"))}}))}play(){if(this.isPlaying||!this.isActive)return;if(this.isReady||this.isLoading)if(this.isLoading)if(this.isBufferedEnough()){this.isReady=true;this.isLoading=false;if(0!==this.showSpinnerStartedTime){this.showSpinnerAccumulatedTime+=performance.now()-this.showSpinnerStartedTime;this.showSpinnerStartedTime=0}this.updateLoadingState();this.statsD("loaded_video");let e={};if(0===this.totalVideoShownCount){this.statsDTiming("spinner_shown_time",this.showSpinnerAccumulatedTime);e={spinnerShownTime:this.showSpinnerAccumulatedTime}}this.logEventPipe("loaded_video",e);this.totalVideoShownCount++;this._play()}else setTimeout((()=>{this.play()}),25);else 1===this.videoEl.readyState?this.videoEl.load():this._play();else{this.isLoading=true;this.updateLoadingState();this.videoEl.addEventListener("loadeddata",(()=>{this.play()}));this.videoEl.addEventListener("error",(e=>{this.onError(e)}));0===this.showSpinnerStartedTime&&(this.showSpinnerStartedTime=performance.now());this.videoEl.load();this.statsD("started_loading_video")}}_play(){if(this.isPlaying)return;(this.videoEl.play()||Promise.resolve()).then((()=>{this.isPlaying=true;this.updatePlayingState()})).catch((e=>this.onError(e)))}stop(){if(!this.isPlaying)return;this.videoEl.pause();this.videoOptimizations||(this.videoEl.currentTime=0);this.isPlaying=false;this.updatePlayingState();this.videoPlayCount=0}isBufferedEnough(){if(0===this.options.enoughBufferedPercentage)return true;const e=this.videoEl.buffered.length?this.videoEl.buffered.end(0):0;e===this.lastBufferedTime&&e!==this.videoEl.duration?this.bufferStalledCount++:this.lastBufferedTime=e;const t=e/this.videoEl.duration>=this.options.enoughBufferedPercentage;const i=this.bufferStalledCount>V;return t||i}updateLoadingState(){if(this.videoOptimizations)return;this.isLoading&&this.isActive?d["default"].wtAccessibleShow(this.spinner):d["default"].wtAccessibleHide(this.spinner)}updatePlayingState(){if(this.isPlaying&&this.isActive){d["default"].wtAccessibleHide(this.signal);this.videoOptimizations?this.showFadeInAnimation(this.videoContainer):d["default"].wtAccessibleShow(this.videoContainer)}else{d["default"].wtAccessibleShow(this.signal);this.videoOptimizations?this.hideFadeInAnimation(this.videoContainer):d["default"].wtAccessibleHide(this.videoContainer)}}onError(e){this.isLoading=false;this.isPlaying=false;this.updateLoadingState();this.updatePlayingState();if("NotAllowedError"===e.name){this.statsD("not_allowed");return}this.logSentryError(e);this.statsD("error")}statsD(e){o["default"].increment(`lc_video.${this.options.moduleName}.${e.toLowerCase()}`,w)}statsDTiming(e,t){o["default"].timing(`lc_video.${this.options.moduleName}.${e.toLowerCase()}`,t,w)}logSentryError(e){n["default"].captureException(e||new Error("Error playing listing card video"),{tags:{component:"listing-card/video-player",module:this.options.moduleName}})}logEventPipe(e,t={}){var i;const o=parseInt(null!==(i=t.listingId)&&void 0!==i?i:this.listingId,10);s["default"].logEvent({event_name:`lc_video_${e}`,module:this.options.moduleName,totalVideoPlayCount:this.totalVideoPlayCount,...t,listingId:o})}hideFadeInAnimation(e){if(!e)return;e.classList.remove("wt-animated--appear-01");e.classList.add("wt-animated--disappear-01");e.setAttribute("aria-hidden","true")}showFadeInAnimation(e){if(!e)return;e.classList.remove("wt-animated--disappear-01");e.classList.add("wt-animated--appear-01");e.setAttribute("aria-hidden","false")}}const b={selector:"listing-card-video",moduleSelectors:null,numOfLoops:5,enoughBufferedPercentage:0,pageName:"",logVideoPresenceOnce:true};class O{constructor(e={}){if(!e.pageName)throw new Error("Listing Card Video Orchestrator needs a page or module name for logging and reporting");this.loggedVideoPresence=false;this.options={...b,...e};this.setUpVideos();t()(document.body).on("etsy.listing.loaded",this.setUpVideos.bind(this))}setUpVideos(){this.options.moduleSelectors&&this.options.moduleSelectors.size>=1?this.setUpVideosForMultipleModules():this.setUpVideosForSingleModule()}setUpVideosForSingleModule(){const e=document.querySelectorAll(`[${this.options.selector}]`);if(e.length){this.loggedVideoPresence&&this.options.logVideoPresenceOnce||this.logThatVideosArePresent(this.options.pageName,true,e.length);Array.prototype.forEach.call(e,(e=>{"VIDEO"===e.tagName&&new A(e,this.getVideoOptions(this.options.selector,this.options.numOfLoops,this.options.enoughBufferedPercentage,this.options.pageName))}))}}setUpVideosForMultipleModules(){this.options.moduleSelectors.forEach(((e,t)=>{const i=`[${e}] [${this.options.selector}]`;const s=document.querySelectorAll(i);if(s.length){this.logThatVideosArePresent(t,false,s.length);Array.prototype.forEach.call(s,(e=>{"VIDEO"===e.tagName&&new A(e,this.getVideoOptions(this.options.selector,this.options.numOfLoops,this.options.enoughBufferedPercentage,t))}))}const o=`[${e}] .wt-video.wt-video--preview`;const n=document.querySelectorAll(o);if(n.length){this.logThatVideosArePresent(t,false,s.length);Array.prototype.forEach.call(n,(e=>{const i=e.closest("a");const s={...C,maxLoops:this.options.numOfLoops,minBufferedPercentage:this.options.enoughBufferedPercentage,moduleName:t};new _(e,i,s);this.attachVideoPreviewEventListeners(e,t)}))}}))}attachVideoPreviewEventListeners(e,t){const i=e.querySelector(y.SELECTORS.VIDEO);const s=e.getAttribute("data-listing-id");i.addEventListener(c.EVENTS.CLICK,(e=>{this.statsD("click_ds",t);this.logEventPipeWithListingId("click",s,e.detail)}));i.addEventListener(c.EVENTS.STOP,(e=>{this.statsD("stop_ds",t);this.logEventPipeWithListingId("stop",s,e.detail)}));i.addEventListener(c.EVENTS.STARTED_LOADING_VIDEO,(e=>{this.statsD("started_loading_video_ds",t)}));i.addEventListener(y.EVENTS.LOADED_VIDEO,(e=>{this.statsD("loaded_video_ds",t);this.logEventPipeWithListingId("loaded_video",s,e.detail);o["default"].timing(`lc_video.${t}.spinner_shown_time_ds`,e.detail.spinnerShownTime)}));i.addEventListener(c.EVENTS.PLAY,(e=>{this.statsD("play_ds",t);this.logEventPipeWithListingId("play",s,e.detail)}));i.addEventListener(c.EVENTS.PLAYING,(e=>{this.statsD("playing_ds",t);this.logEventPipeWithListingId("playing",s,e.detail)}));i.addEventListener(c.EVENTS.FINISHED_FIRST_PLAY,(e=>{this.logEventPipeWithListingId("finished_first_video_play",s,e.detail)}));i.addEventListener(c.EVENTS.LOOP,(e=>{this.statsD("loop_ds",t);this.logEventPipeWithListingId("loop",s,e.detail)}));i.addEventListener(c.EVENTS.FINISHED_AUTOPLAY,(e=>{this.statsD("finished_autoplay_ds");this.logEventPipeWithListingId("finished_autoplay",s,e.detail)}));i.addEventListener(c.EVENTS.ERROR,(e=>{if("NotAllowedError"===e.name){this.statsD("not_allowed_ds",t);return}this.statsD("error_ds",t);n["default"].captureException(e||new Error("Error playing listing card video"),{tags:{component:"listing-card/video-player",module:this.options.moduleName}})}))}statsD(e,t=null){const i=null!==t&&void 0!==t?t:this.options.moduleName;o["default"].increment(`lc_video.${i}.${e.toLowerCase()}`,w)}logEventPipeWithListingId(e,t,i={}){s["default"].logEvent({event_name:`lc_video_${e}`,listingId:parseInt(t,10),...i})}getVideoOptions(e,t,i,s){return{...C,selector:e,numOfLoops:t,enoughBufferedPercentage:i,moduleName:s}}logThatVideosArePresent(e,t=false,i=null){this.loggedVideoPresence=t;s["default"].logEvent({event_name:`lc_video_present`,module:e,num_videos:i})}}class D{static log(){const e=D.getUniqueVideos();if(e.length>0){const t={sm:0,md:0,lg:0};e.forEach((e=>{const i=e.closest(".v2-listing-card");if(i){const e=i.classList;e.contains("wt-grid__item-xl-3")?t.sm++:e.contains("wt-grid__item-xl-4")?t.md++:e.contains("wt-grid__item-xl-6")&&t.lg++}}));s["default"].logEvent({event_name:"shop_home_featured_listing_videos_loaded",num_videos:e.length,num_sm_videos:t.sm,num_md_videos:t.md,num_lg_videos:t.lg})}}static getUniqueVideos(){const e=document.querySelectorAll(`.featured-products-area:not(.wt-display-none) video`);const t={};Array.from(e).forEach((e=>{const i=e.getAttribute("data-listing-id");i&&(t[i]=e)}));return Object.values(t)}}new O({pageName:"shop_home",logVideoPresenceOnce:false});D.log();t()(document.body).on("etsy.listing.loaded",D.log)})()})();
//# sourceMappingURL=https://www.etsy.com/sourcemaps/evergreenVendor/en-US/shop2/home-listing-card-videos.fbc4267c9f36a39d380b.js.map